"use strict";exports.id=248,exports.ids=[248],exports.modules={4248:(e,a,t)=>{t.d(a,{$:()=>D});var n=t(326),l=t(7577),r=t(4723),i=t(4064),s=t(2576),o=t(1664),d=t(1190),c=t(1223),m=t(4214);let u=l.createContext({}),x=({...e})=>n.jsx(u.Provider,{value:{name:e.name},children:n.jsx(r.Qr,{...e})}),p=()=>{let e=l.useContext(u),{getFieldState:a,formState:t}=(0,r.Gc)(),n=a(e.name,t);if(!e)throw Error("useFormField should be used within <FormField>");return{name:e.name,...n}};function h({children:e,className:a,form:t,...l}){return n.jsx(r.RV,{...t,children:n.jsx("form",{className:(0,c.cn)("space-y-6",a),autoComplete:"off",...l,children:e})})}function b({className:e,...a}){return n.jsx("div",{className:(0,c.cn)("mb-2 rounded-lg bg-gradient-to-r from-blue-50 via-pink-50 to-yellow-50 dark:from-zinc-800 dark:via-zinc-900 dark:to-zinc-800 p-3",e),...a})}function g({className:e,...a}){return n.jsx("label",{className:(0,c.cn)("block text-base font-semibold mb-1",e),...a})}function j({...e}){let{error:a,name:t}=p();return n.jsx(m.g7,{id:t,"aria-invalid":!!a,...e})}function f({className:e,...a}){let{error:t}=p(),l=t?String(t?.message):a.children;return l?n.jsx("div",{className:(0,c.cn)("text-xs text-red-600 mt-1",e),...a,children:l}):null}j.displayName="AppFormControl",f.displayName="AppFormMessage";var k=t(4690),v=t(4097),y=t(3682);t(76),t(445);let N=["Mechanical","Electrical","Production","Quality","Other"],z=s.z.object({complaintId:s.z.string(),complaintDate:s.z.string(),machineName:s.z.string().min(1,"Machine name is required"),complaintDescription:s.z.string().min(1,"Description is required"),priority:s.z.enum(["Low","Medium","High"]),complaintStatus:s.z.enum(["Open","In Progress","Closed","Pending Parts"]).default("Open"),actionDate:s.z.string().nullable().default(null),maintenanceRemarks:s.z.string().nullable().default(null),initialInspectionDate:s.z.string().nullable().default(null),estimatedEndDate:s.z.string().nullable().default(null),finalizationDate:s.z.string().nullable().default(null),createdBy:s.z.string().email("Valid email required"),department:s.z.string().min(1,"Department is required"),assignedTo:s.z.enum(["Person A","Person B","Person C","Person D"]).default("Person A"),materialsUsed:s.z.array(s.z.object({name:s.z.string().min(1,"Material name required"),quantity:s.z.string().min(1,"Quantity required"),remarks:s.z.string().optional()})).default([]),history:s.z.array(s.z.object({action:s.z.string(),user:s.z.string(),timestamp:s.z.string()})).default([])}),w=e=>"complaint"===e?[{name:"-",quantity:"-",remarks:"-"}]:[{name:"",quantity:"",remarks:""}];function D({onSuccess:e,complaint:a}){let{currentUser:t,loading:s}=(0,k.a)(),{toast:c}=(0,v.p)(),[m,u]=(0,l.useState)(!1),[p,D]=(0,l.useState)(a?.materialsUsed||w(t?.role||"")),[I,C]=(0,l.useState)(a?.department||"Mechanical"),[F,S]=(0,l.useState)(a?.history||[]),[P,U]=(0,l.useState)(a?.complaintId||""),q=(0,r.cI)({resolver:(0,i.F)(z),defaultValues:{complaintId:a?.complaintId||"",complaintDate:a?.complaintDate||new Date().toISOString().split("T")[0],machineName:a?.machineName||"",complaintDescription:a?.complaintDescription||"",priority:a?.priority||"Low",complaintStatus:a?.complaintStatus||"Open",actionDate:a?.actionDate||null,maintenanceRemarks:a?.maintenanceRemarks||null,initialInspectionDate:a?.initialInspectionDate||null,estimatedEndDate:a?.estimatedEndDate||null,finalizationDate:a?.finalizationDate||null,createdBy:a?.createdBy||t?.email||"",department:a?.department||"",assignedTo:a?.assignedTo||"Person A",materialsUsed:a?.materialsUsed||w(t?.role||""),history:a?.history||[]}}),E=async n=>{if(console.group("[ComplaintForm] onSubmit Debug"),console.log("currentUser:",t),console.log("form data:",n),!t||!t.email||!/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(t.email)){c({title:"Error",description:"You must be logged in with a valid email to submit a complaint.",variant:"destructive"}),console.warn("Submission blocked: invalid or missing user/email",t),console.groupEnd();return}u(!0);try{let l;let r=new Date().toISOString(),i=t.email,s=[];(s=a?[...Array.isArray(a.history)?a.history:[],{action:"Updated",user:i,timestamp:r}]:[{action:"Created",user:i,timestamp:r}])&&0!==s.length||(s=[{action:"Created",user:i,timestamp:r}]);let o={...n,assignedTo:n.assignedTo,createdBy:i,department:n.department,materialsUsed:p,history:s};if(console.log("Submitting payload:",o),l=a?.id?await (0,y.Rw)(a.id,o):await (0,y.GH)(o),console.log("Submission result:",l),l.success)c({title:"Success",description:l.message}),q.reset(),e(),console.info("Complaint submitted successfully:",{payload:o,result:l,user:t,time:new Date().toISOString()});else{let e="object"==typeof l.error?JSON.stringify(l.error):l.error;c({title:"Error",description:e||l.message||"Submission failed",variant:"destructive"}),console.error("Backend error:",l.message,e)}}catch(e){console.error("Submission error:",e),c({title:"Error",description:e?.message||"An unexpected error occurred",variant:"destructive"})}finally{u(!1),console.groupEnd()}};return s?(console.log("[ComplaintForm] AuthContext loading, not rendering form."),n.jsx("div",{className:"mb-4 p-4 bg-blue-100 text-blue-800 rounded text-center font-semibold animate-pulse",children:"Checking login status..."})):null==t?(console.warn("[ComplaintForm] currentUser is null, blocking form."),n.jsx("div",{className:"mb-4 p-4 bg-red-100 text-red-800 rounded text-center font-semibold",children:"You must be logged in to submit a complaint."})):"viewer"===t.role?(console.warn("[ComplaintForm] currentUser.role is viewer, blocking form."),n.jsx("div",{className:"mb-4 p-4 bg-yellow-100 text-yellow-800 rounded text-center font-semibold",children:"You do not have permission to submit a complaint."})):n.jsx(h,{form:q,onSubmit:q.handleSubmit(E),children:(0,n.jsxs)("div",{className:"max-w-3xl mx-auto bg-white dark:bg-zinc-900 rounded-2xl shadow-lg p-8 border border-zinc-200 dark:border-zinc-800 mt-6",children:[n.jsx("h2",{className:"text-2xl font-bold text-primary mb-6 text-center tracking-tight",children:"Complaint Form"}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,n.jsxs)("div",{className:"md:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-6 bg-gradient-to-r from-blue-50 via-pink-50 to-yellow-50 dark:from-zinc-800 dark:via-zinc-900 dark:to-zinc-800 rounded-xl p-6 mb-4",children:[n.jsx(x,{control:q.control,name:"complaintId",render:({field:e})=>(0,n.jsxs)(b,{children:[n.jsx(g,{htmlFor:e.name,className:"text-blue-700 dark:text-blue-300",children:"Complaint ID"}),n.jsx(j,{children:n.jsx(d.I,{...e,id:e.name,name:e.name,readOnly:!0,className:"bg-blue-100 dark:bg-zinc-800 font-semibold text-blue-900 dark:text-blue-200"})}),n.jsx(f,{})]})}),n.jsx(x,{control:q.control,name:"complaintDate",render:({field:e})=>(0,n.jsxs)(b,{children:[n.jsx(g,{htmlFor:e.name,className:"text-pink-700 dark:text-pink-300",children:"Complaint Date"}),n.jsx(j,{children:n.jsx(d.I,{type:"date",...e,id:e.name,name:e.name,className:"bg-pink-100 dark:bg-zinc-800 text-pink-900 dark:text-pink-200",disabled:"complaint"===t.role&&!1})}),n.jsx(f,{})]})}),n.jsx(x,{control:q.control,name:"machineName",render:({field:e})=>(0,n.jsxs)(b,{children:[n.jsx(g,{htmlFor:e.name,className:"text-yellow-700 dark:text-yellow-300",children:"Machine Name"}),n.jsx(j,{children:n.jsx(d.I,{...e,id:e.name,name:e.name,className:"bg-yellow-100 dark:bg-zinc-800 text-yellow-900 dark:text-yellow-200",disabled:"complaint"!==t.role&&!1})}),n.jsx(f,{})]})}),n.jsx(x,{control:q.control,name:"complaintDescription",render:({field:e})=>(0,n.jsxs)(b,{className:"md:col-span-2",children:[n.jsx(g,{htmlFor:e.name,className:"text-purple-700 dark:text-purple-300",children:"Description"}),n.jsx(j,{children:n.jsx(d.I,{...e,id:e.name,name:e.name,className:"bg-purple-100 dark:bg-zinc-800 text-purple-900 dark:text-purple-200",disabled:"complaint"!==t.role&&!1})}),n.jsx(f,{})]})})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[n.jsx(x,{control:q.control,name:"priority",render:({field:e})=>(0,n.jsxs)(b,{children:[n.jsx(g,{htmlFor:e.name,className:"text-red-700 dark:text-red-300",children:"Priority"}),n.jsx(j,{children:(0,n.jsxs)("select",{...e,id:e.name,name:e.name,className:"w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-400 bg-white text-black",disabled:"complaint"!==t.role&&!1,children:[n.jsx("option",{value:"Low",children:"Low"}),n.jsx("option",{value:"Medium",children:"Medium"}),n.jsx("option",{value:"High",children:"High"})]})}),n.jsx(f,{})]})}),n.jsx(x,{control:q.control,name:"complaintStatus",render:({field:e})=>(0,n.jsxs)(b,{children:[n.jsx(g,{htmlFor:e.name,className:"text-green-700 dark:text-green-300",children:"Status"}),n.jsx(j,{children:(0,n.jsxs)("select",{...e,id:e.name,name:e.name,className:"w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-green-400 bg-white text-black",required:!0,disabled:"complaint"===t.role,children:[n.jsx("option",{value:"Open",children:"Open"}),n.jsx("option",{value:"In Progress",children:"In Progress"}),n.jsx("option",{value:"Closed",children:"Closed"}),n.jsx("option",{value:"Pending Parts",children:"Pending Parts"}),n.jsx("option",{value:"Pending",children:"Pending"}),n.jsx("option",{value:"Completed",children:"Completed"})]})}),n.jsx(f,{})]})}),n.jsx(x,{control:q.control,name:"actionDate",render:({field:e})=>(0,n.jsxs)(b,{children:[(0,n.jsxs)(g,{htmlFor:e.name,children:["Action Date ",n.jsx("span",{className:"text-xs text-gray-500",children:"(Date when action was/will be taken)"})]}),n.jsx(j,{children:n.jsx(d.I,{type:"date",...e,id:e.name,name:e.name,value:e.value||"",disabled:"complaint"===t.role})}),n.jsx(f,{})]})}),n.jsx(x,{control:q.control,name:"maintenanceRemarks",render:({field:e})=>(0,n.jsxs)(b,{children:[n.jsx(g,{htmlFor:e.name,children:"Maintenance Remarks"}),n.jsx(j,{children:n.jsx(d.I,{...e,id:e.name,name:e.name,value:e.value||"",disabled:"complaint"===t.role})}),n.jsx(f,{})]})}),n.jsx(x,{control:q.control,name:"initialInspectionDate",render:({field:e})=>(0,n.jsxs)(b,{children:[(0,n.jsxs)(g,{htmlFor:e.name,children:["Initial Inspection Date ",n.jsx("span",{className:"text-xs text-gray-500",children:"(First check/inspection date)"})]}),n.jsx(j,{children:n.jsx(d.I,{type:"date",...e,id:e.name,name:e.name,value:e.value||"",disabled:"complaint"===t.role})}),n.jsx(f,{})]})}),n.jsx(x,{control:q.control,name:"estimatedEndDate",render:({field:e})=>(0,n.jsxs)(b,{children:[(0,n.jsxs)(g,{htmlFor:e.name,children:["Estimated End Date ",n.jsx("span",{className:"text-xs text-gray-500",children:"(Expected completion date)"})]}),n.jsx(j,{children:n.jsx(d.I,{type:"date",...e,id:e.name,name:e.name,value:e.value||"",disabled:"complaint"===t.role})}),n.jsx(f,{})]})}),n.jsx(x,{control:q.control,name:"finalizationDate",render:({field:e})=>(0,n.jsxs)(b,{children:[(0,n.jsxs)(g,{htmlFor:e.name,children:["Finalization Date ",n.jsx("span",{className:"text-xs text-gray-500",children:"(Date when complaint was fully resolved)"})]}),n.jsx(j,{children:n.jsx(d.I,{type:"date",...e,id:e.name,name:e.name,value:e.value||"",disabled:"complaint"===t.role})}),n.jsx(f,{})]})}),n.jsx(x,{control:q.control,name:"createdBy",render:({field:e})=>(0,n.jsxs)(b,{children:[n.jsx(g,{htmlFor:e.name,children:"Created By (Email)"}),n.jsx(j,{children:n.jsx(d.I,{type:"email",...e,id:e.name,name:e.name,value:e.value||"",readOnly:!0})}),n.jsx(f,{})]})}),n.jsx(x,{control:q.control,name:"department",render:({field:e})=>(0,n.jsxs)(b,{children:[n.jsx(g,{htmlFor:e.name,className:"text-indigo-700 dark:text-indigo-300",children:"Concerned Department"}),n.jsx(j,{children:n.jsx("select",{...e,id:e.name,name:e.name,className:"w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-400 bg-white text-black",disabled:"complaint"!==t.role&&!1,children:N.map(e=>n.jsx("option",{value:e,children:e},e))})}),n.jsx(f,{})]})}),n.jsx(x,{control:q.control,name:"assignedTo",render:({field:e})=>(0,n.jsxs)(b,{children:[n.jsx(g,{className:"text-blue-700 dark:text-blue-300",children:"Assigned To"}),n.jsx(j,{children:(0,n.jsxs)("select",{...e,className:"w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-400 bg-white text-black",disabled:"complaint"===t.role,children:[n.jsx("option",{value:"Person A",children:"Person A"}),n.jsx("option",{value:"Person B",children:"Person B"}),n.jsx("option",{value:"Person C",children:"Person C"}),n.jsx("option",{value:"Person D",children:"Person D"})]})}),n.jsx(f,{})]})})]}),(0,n.jsxs)("div",{className:"md:col-span-2 mt-6",children:[n.jsx("h3",{className:"text-lg font-semibold text-pink-700 dark:text-pink-300 mb-2",children:"Materials Used"}),(0,n.jsxs)("div",{className:"space-y-2",children:[p.map((e,a)=>(0,n.jsxs)("div",{className:"flex gap-2 mb-2 items-center",children:[(0,n.jsxs)("div",{className:"flex flex-col w-1/3",children:[n.jsx("label",{htmlFor:`material-name-${a}`,className:"block text-xs font-semibold mb-1",children:"Material Name"}),n.jsx(d.I,{id:`material-name-${a}`,name:`materialsUsed.${a}.name`,placeholder:"Material Name",value:"complaint"===t.role?"-":e.name,onChange:e=>{if("complaint"!==t.role){let t=[...p];t[a].name=e.target.value,D(t),q.setValue("materialsUsed",t)}},className:"bg-blue-50 dark:bg-zinc-800",required:!0,disabled:"complaint"===t.role})]}),(0,n.jsxs)("div",{className:"flex flex-col w-1/4",children:[n.jsx("label",{htmlFor:`material-quantity-${a}`,className:"block text-xs font-semibold mb-1",children:"Quantity"}),n.jsx(d.I,{id:`material-quantity-${a}`,name:`materialsUsed.${a}.quantity`,placeholder:"Quantity",value:"complaint"===t.role?"-":e.quantity,onChange:e=>{if("complaint"!==t.role){let t=[...p];t[a].quantity=e.target.value,D(t),q.setValue("materialsUsed",t)}},className:"bg-yellow-50 dark:bg-zinc-800",required:!0,disabled:"complaint"===t.role})]}),(0,n.jsxs)("div",{className:"flex flex-col w-1/3",children:[n.jsx("label",{htmlFor:`material-remarks-${a}`,className:"block text-xs font-semibold mb-1",children:"Remarks"}),n.jsx(d.I,{id:`material-remarks-${a}`,name:`materialsUsed.${a}.remarks`,placeholder:"Remarks",value:"complaint"===t.role?"-":e.remarks||"",onChange:e=>{if("complaint"!==t.role){let t=[...p];t[a].remarks=e.target.value,D(t),q.setValue("materialsUsed",t)}},className:"bg-pink-50 dark:bg-zinc-800",disabled:"complaint"===t.role})]}),n.jsx(o.z,{type:"button",variant:"destructive",size:"sm",onClick:()=>{if("complaint"!==t.role){let e=p.filter((e,t)=>t!==a);D(e),q.setValue("materialsUsed",e)}},disabled:1===p.length||"complaint"===t.role,children:"Remove"})]},a)),n.jsx(o.z,{type:"button",variant:"secondary",size:"sm",className:"bg-gradient-to-r from-blue-200 via-pink-200 to-yellow-200 dark:from-zinc-700 dark:via-zinc-800 dark:to-zinc-700 text-blue-900 dark:text-blue-200",onClick:()=>{if("complaint"!==t.role){let e=[...p,{name:"",quantity:"",remarks:""}];D(e),q.setValue("materialsUsed",e)}},disabled:"complaint"===t.role,children:"+ Add Material"})]})]}),(0,n.jsxs)("div",{className:"md:col-span-2 mt-6",children:[n.jsx("h3",{className:"text-lg font-semibold text-green-700 dark:text-green-300 mb-2",children:"Complaint History"}),n.jsx("div",{className:"bg-gradient-to-r from-green-50 via-blue-50 to-pink-50 dark:from-zinc-800 dark:via-zinc-900 dark:to-zinc-800 rounded p-3 max-h-40 overflow-y-auto text-xs",children:0===F.length?n.jsx("div",{className:"text-gray-500",children:"No history yet."}):F.map((e,a)=>(0,n.jsxs)("div",{className:"mb-1",children:[n.jsx("span",{className:"font-semibold text-green-700 dark:text-green-300",children:e.action})," by ",n.jsx("span",{className:"text-blue-700 dark:text-blue-300",children:e.user})," on ",n.jsx("span",{className:"text-pink-700 dark:text-pink-300",children:new Date(e.timestamp).toLocaleString()})]},a))})]}),n.jsx("div",{className:"md:col-span-2 mt-8",children:n.jsx(o.z,{type:"submit",disabled:m||!t?.email,className:"w-full text-lg font-bold bg-gradient-to-r from-blue-500 via-pink-500 to-yellow-500 text-white shadow-lg hover:from-blue-600 hover:via-pink-600 hover:to-yellow-600",children:m?"Submitting...":a?"Update":"Submit"})})]})]})},t?.email||"nouser")}},1190:(e,a,t)=>{t.d(a,{I:()=>i});var n=t(326),l=t(7577),r=t(1223);let i=l.forwardRef(({className:e,...a},t)=>n.jsx("input",{ref:t,className:(0,r.cn)("block w-full rounded-lg border border-blue-200 dark:border-zinc-700 bg-white dark:bg-zinc-900 px-4 py-2 text-base text-blue-900 dark:text-blue-200 placeholder:text-blue-400 dark:placeholder:text-zinc-500 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-400 transition-all duration-150 shadow-sm","hover:border-pink-400 dark:hover:border-pink-400",e),...a}));i.displayName="Input"}};